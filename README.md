
## 1. ERD 설계
![image](https://github.com/user-attachments/assets/13d87bc1-5e58-4eb5-8707-3f87914e6e15)


- **`users`** Table :
    - 유저 정보 테이블
    - [ Id, 이름 ] 
- **`lecture`** Table :
    - 특강 정보 테이블
    - [ Id, 강의명, 강사이름, 특강날, 정원, 현재 예약 수]
- **`reservationLecture`** Table :
    - `users`와 `Lecture` 의 중간 테이블. 강의예약 테이블. 
    - [ Id , 강의 Id , 유저 Id , 예약 상태 ]

**모든 테이블은 기본적으로 `등록시간과/ 수정시간`** 을 가지고 있습니다.

<br>

### 해당 테이블로 구성 한 이유
- reservationLecture를 생성하여 n -> 1 <- n 의 관계가 될 수 있도록 만들었습니다.
- reservationLecture을 통해, 예약 상태를 쉽게 조회할 수 있습니다.
- reservationStatus의 경우 차후 취소 등의 기능을 추가 또는, 실패를 기록하기 위해 확장성을 위해 추가하였습니다.
- current_reservation_count를 lecture에 등록함으로써 신청 가능/불가능을 판단하는데 이점 되는 것으로 판단하였습니다. 
- 기본 등록시간/ 수정시간을 등록함으로써, 통계와 스냅샷 기능을 할 수 있습니다.


## 아키텍처 
**도메인 모델 + 레이어 구조** 를 사용

처음에는 도메인 모델을 강조하기 위해 도메인 모델 + 도메인 구조를 사용하였습니다. 
- 도메인 구조에 익숙하지 않다보니 책임이 명확하게 구분이 어려웠습니다.
- 그래서 도메인 모델 + 안쪽으로 레이어 구조로 하니, 간단한 프로젝트 치고 너무 거대한 구조가 되가는 것 같았습니다.

도메인 모델 + 레이어 구조로 변경하였습니다
- import 문 만으로도 다른 레이어의 침범이 있는지 없는지 확인 할 수 있었습니다.
- 핵심 원칙인 책임 분리와 의존성 관리를 준수할 수 있었습니다. 

해서 이러한 구조를 사용하였습니다
```aiignore
L adapters //외부연결
  L web
    L controller
    L Request/Response //아직 refactor 못함! 
  L persistence  
    L repository (구현)
L application
  L service
    L dto  
L domain
  L entity
  L repository 
  L service (필요시)
```


## DB 락
다수의 서버와 다중 사용자의 동시성 문제를 해결하기 위해
데이터베이스 수준에서 락 (Lock) 을 사용하기로 하였습니다.

그럼 여기서  **비관적 락 VS 낙관적 락** 중에 어느 락을 사용 할 것인가?

1. 낙관적 락
낙관적 락은 : "데이터 충돌이 발생하지 않을 거야~" 라고 낙관적으로 가정 하는 락입니다.
데이터를 읽을 때 현재 'version' 값을 가져옵니다. 업데이트를 하고 'version'을 증가시킵니다.
버전이 다르면 업데이트에 실패하고, 예외를 발생시킵니다.
동시에 신청하게 될 경우 앞쪽에서는 실패하고, 뒤에서는 성공하는 경우가 생길 수 있습니다. 

2. 비관적 락
비관적 락은 : "데이터 충돌이 무조건 발생할꺼야~ "라고 비관적으로 생각하여 락을 걸어 다른 트랜잭션의 접근을 차단합니다.
데이터 충돌이 발생하지 않아 데이터 무결성과 일관성을 확보할 수 있습니다.

따라서 비관적 락을 선택하였습니다. 
또한 비관적 락에서 발생할 수 있는 데드락을 방지하기 위해 **락 타임아웃**을 설정하였습니다
```
@QueryHint(name = "javax.persistence.lock.timeout", value = "3000")  
```

## 유비쿼터스 언어 정리

| 용어                                    | 정의                                      |
|---------------------------------------|-----------------------------------------|
| **사용자(User)**                         | 시스템에 로그인하여 강의를 예약하는 개인                  |
| **강의(Lecture)**                       | 특정 날짜에 진행되는 특강                          |
| **강의 예약(ReservationLecture)**         | 사용자가 신청한 강의 예약                          |
| **예약 상태(ReservationStatus)**          | 예약의 현재 상태를 나타냄 (ACTIVE 활성,INACTIVE 비활성) |
| **정원(Capacity)**                      | 강의에 신청 할 수 있는 최대 수                      |
| **현재 예약 인원(currentReservationCount)** | 현재 해당 강의에 예약 수                          |         

